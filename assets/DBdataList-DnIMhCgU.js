import{d as R,b,e as p,B as q,_ as x,c as D,o as v,a as r,w as A,v as M,t as m,F as z,k as G}from"./index-Bgho3WtG.js";const P=(e,t)=>t.some(n=>e instanceof n);let k,S;function H(){return k||(k=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function J(){return S||(S=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const E=new WeakMap,I=new WeakMap,h=new WeakMap;function X(e){const t=new Promise((n,o)=>{const l=()=>{e.removeEventListener("success",a),e.removeEventListener("error",s)},a=()=>{n(f(e.result)),l()},s=()=>{o(e.error),l()};e.addEventListener("success",a),e.addEventListener("error",s)});return h.set(t,e),t}function Y(e){if(E.has(e))return;const t=new Promise((n,o)=>{const l=()=>{e.removeEventListener("complete",a),e.removeEventListener("error",s),e.removeEventListener("abort",s)},a=()=>{n(),l()},s=()=>{o(e.error||new DOMException("AbortError","AbortError")),l()};e.addEventListener("complete",a),e.addEventListener("error",s),e.addEventListener("abort",s)});E.set(e,t)}let U={get(e,t,n){if(e instanceof IDBTransaction){if(t==="done")return E.get(e);if(t==="store")return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return f(e[t])},set(e,t,n){return e[t]=n,!0},has(e,t){return e instanceof IDBTransaction&&(t==="done"||t==="store")?!0:t in e}};function T(e){U=e(U)}function Z(e){return J().includes(e)?function(...t){return e.apply(C(this),t),f(this.request)}:function(...t){return f(e.apply(C(this),t))}}function _(e){return typeof e=="function"?Z(e):(e instanceof IDBTransaction&&Y(e),P(e,H())?new Proxy(e,U):e)}function f(e){if(e instanceof IDBRequest)return X(e);if(I.has(e))return I.get(e);const t=_(e);return t!==e&&(I.set(e,t),h.set(t,e)),t}const C=e=>h.get(e);function ee(e,t,{blocked:n,upgrade:o,blocking:l,terminated:a}={}){const s=indexedDB.open(e,t),d=f(s);return o&&s.addEventListener("upgradeneeded",i=>{o(f(s.result),i.oldVersion,i.newVersion,f(s.transaction),i)}),n&&s.addEventListener("blocked",i=>n(i.oldVersion,i.newVersion,i)),d.then(i=>{a&&i.addEventListener("close",()=>a()),l&&i.addEventListener("versionchange",c=>l(c.oldVersion,c.newVersion,c))}).catch(()=>{}),d}const te=["get","getKey","getAll","getAllKeys","count"],ne=["put","add","delete","clear"],w=new Map;function V(e,t){if(!(e instanceof IDBDatabase&&!(t in e)&&typeof t=="string"))return;if(w.get(t))return w.get(t);const n=t.replace(/FromIndex$/,""),o=t!==n,l=ne.includes(n);if(!(n in(o?IDBIndex:IDBObjectStore).prototype)||!(l||te.includes(n)))return;const a=async function(s,...d){const i=this.transaction(s,l?"readwrite":"readonly");let c=i.store;return o&&(c=c.index(d.shift())),(await Promise.all([c[n](...d),l&&i.done]))[0]};return w.set(t,a),a}T(e=>({...e,get:(t,n,o)=>V(t,n)||e.get(t,n,o),has:(t,n)=>!!V(t,n)||e.has(t,n)}));const se=["continue","continuePrimaryKey","advance"],N={},L=new WeakMap,j=new WeakMap,re={get(e,t){if(!se.includes(t))return e[t];let n=N[t];return n||(n=N[t]=function(...o){L.set(this,j.get(this)[t](...o))}),n}};async function*oe(...e){let t=this;if(t instanceof IDBCursor||(t=await t.openCursor(...e)),!t)return;t=t;const n=new Proxy(t,re);for(j.set(n,t),h.set(n,C(t));t;)yield n,t=await(L.get(n)||t.continue()),L.delete(n)}function F(e,t){return t===Symbol.asyncIterator&&P(e,[IDBIndex,IDBObjectStore,IDBCursor])||t==="iterate"&&P(e,[IDBIndex,IDBObjectStore])}T(e=>({...e,get(t,n,o){return F(t,n)?oe:e.get(t,n,o)},has(t,n){return F(t,n)||e.has(t,n)}}));const g=async()=>ee("UserDatabase",1,{upgrade(e){e.createObjectStore("users",{keyPath:"id"}).createIndex("by-email","email")}}),B={async addUser(e){return(await g()).add("users",{...e,id:crypto.randomUUID(),createdAt:Date.now()})},async getUserByName(e){return(await g()).getFromIndex("users","by-name",e)},async getUserByEmail(e){return(await g()).getFromIndex("users","by-email",e)},async getAllUser(){return(await g()).getAll("users")}},ae=R({name:"database",setup(){const e=b(""),t=b(""),n=async()=>{e.value.trim()===""||t.value.trim()===""||(await B.addUser({name:e.value,email:t.value,createdAt:Date.now()}),console.log("add_user_data_: success!"),o())},o=async()=>{d.value=await B.getAllUser(),console.log("query_data_all: ",d.value)},l=async()=>{const u=t.value.trim();if(u==="")return;const y=await B.getUserByEmail(u);d.value=y?[y]:[],console.log(u,"query_data_email: ",y)},a=b(1),s=10,d=b([]),i=p(()=>Math.ceil(d.value.length/s)),c=p(()=>d.value.length),O=()=>{a.value<i.value&&a.value++},$=()=>{a.value>1&&a.value--},Q=p(()=>{const u=(a.value-1)*s,y=u+s;return d.value.slice(u,y)}),W=u=>{console.log("edit_user: ",u)},K=u=>{console.log("delete_id:",u)};return q(async()=>{o()}),{userName:e,userEmail:t,handleAddUser:n,handleQueryAll:o,handleQueryEmail:l,usersListLenth:c,users:d,nextPage:O,prevPage:$,totalPages:i,currentPage:a,usersPerPage:s,paginatedUsers:Q,editUser:W,deleteUser:K}}}),ie={class:"dbdata-list"},le={class:"input_wrapper"},de={class:"data-wrapper"},ue={class:"pagination-controls"},ce=["disabled"],fe=["disabled"],me={class:"table-container"},ye={class:"actions"},be=["onClick"],ge=["onClick"];function he(e,t,n,o,l,a){return v(),D("div",ie,[t[11]||(t[11]=r("h1",null,"IndexDB dataList",-1)),r("p",le,[t[7]||(t[7]=r("span",null,"UserName: ",-1)),A(r("input",{type:"text","onUpdate:modelValue":t[0]||(t[0]=s=>e.userName=s)},null,512),[[M,e.userName]]),t[8]||(t[8]=r("span",null,"UserEmail: ",-1)),A(r("input",{type:"text","onUpdate:modelValue":t[1]||(t[1]=s=>e.userEmail=s)},null,512),[[M,e.userEmail]]),r("button",{onClick:t[2]||(t[2]=(...s)=>e.handleAddUser&&e.handleAddUser(...s))},"addUser"),r("button",{onClick:t[3]||(t[3]=(...s)=>e.handleQueryAll&&e.handleQueryAll(...s))},"queryAllUser"),r("button",{onClick:t[4]||(t[4]=(...s)=>e.handleQueryEmail&&e.handleQueryEmail(...s))},"queryUserByEmail")]),r("div",de,[r("div",ue,[r("span",null,"allUserLen: "+m(e.usersListLenth),1),r("button",{onClick:t[5]||(t[5]=(...s)=>e.prevPage&&e.prevPage(...s)),disabled:e.currentPage===1},"Previous",8,ce),r("span",null,"Page "+m(e.currentPage)+" of "+m(e.totalPages),1),r("button",{onClick:t[6]||(t[6]=(...s)=>e.nextPage&&e.nextPage(...s)),disabled:e.currentPage===e.totalPages},"Next",8,fe)]),r("div",me,[t[10]||(t[10]=r("h2",null,"用户列表",-1)),r("table",null,[t[9]||(t[9]=r("thead",null,[r("tr",null,[r("th",null,"ID"),r("th",null,"姓名"),r("th",null,"邮箱"),r("th",null,"操作")])],-1)),r("tbody",null,[(v(!0),D(z,null,G(e.paginatedUsers,s=>(v(),D("tr",{key:s.id},[r("td",null,m(s.id),1),r("td",null,m(s.name),1),r("td",null,m(s.email),1),r("td",ye,[r("button",{class:"edit_btn",onClick:d=>e.editUser(s)},"编辑",8,be),r("button",{class:"del_btn",onClick:d=>e.deleteUser(s.id)},"删除",8,ge)])]))),128))])])])])])}const De=x(ae,[["render",he],["__scopeId","data-v-6c41be7c"]]);export{De as default};
